From d86d2baebf9e63bc3a522a46a91ab03d0d8e5b49 Mon Sep 17 00:00:00 2001
From: Alexander Graf <agraf@suse.de>
Date: Wed, 27 Feb 2013 20:20:22 +0100
Subject: [PATCH 083/169] move signal return code to full hex blob, that way it
 works at least

---
 linux-user/signal.c | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

Index: qemu-1.6.0+dfsg/linux-user/signal.c
===================================================================
--- qemu-1.6.0+dfsg.orig/linux-user/signal.c	2013-11-05 22:23:33.167390094 +0000
+++ qemu-1.6.0+dfsg/linux-user/signal.c	2013-11-05 22:23:33.163390104 +0000
@@ -1247,10 +1247,12 @@
 
     err |= __get_user(magic, &aux->fpsimd.head.magic);
     err |= __get_user(size, &aux->fpsimd.head.size);
-    if (err)
+    if (err) {
         return err;
-    if (magic != TARGET_FPSIMD_MAGIC || size != sizeof(struct target_fpsimd_context))
+    }
+    if (magic != TARGET_FPSIMD_MAGIC || size != sizeof(struct target_fpsimd_context)) {
         return 1;
+    }
 
     for (i = 0; i < 32 * 2; i++) {
        err |= __get_user(env->fregs[i], &aux->fpsimd.vregs[i]);
@@ -1306,8 +1308,7 @@
                       &frame->uc.tuc_stack.ss_size);
     err |= target_setup_sigframe(frame, env, set);
     /* mov x8,#__NR_rt_sigreturn; svc #0 */
-    err |= __put_user(0xd2800008 + (TARGET_NR_rt_sigreturn << 9),
-		      &frame->tramp[0]);
+    err |= __put_user(0xd2801168, &frame->tramp[0]);
     err |= __put_user(0xd4000001, &frame->tramp[1]);
     if (err == 0) {
 	env->xregs[0] = usig;
