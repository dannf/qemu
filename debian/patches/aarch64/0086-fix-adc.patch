From d4191b58555531239059fd88c84ba0c298060fcf Mon Sep 17 00:00:00 2001
From: Alexander Graf <agraf@suse.de>
Date: Thu, 28 Feb 2013 00:38:53 +0100
Subject: [PATCH 086/169] fix adc

---
 target-arm/cpu.h           | 12 ++++++++----
 target-arm/translate-a64.c |  2 +-
 2 files changed, 9 insertions(+), 5 deletions(-)

Index: qemu-1.6.0+dfsg/target-arm/cpu.h
===================================================================
--- qemu-1.6.0+dfsg.orig/target-arm/cpu.h	2013-11-05 22:23:33.767388540 +0000
+++ qemu-1.6.0+dfsg/target-arm/cpu.h	2013-11-05 22:23:33.755388573 +0000
@@ -294,10 +294,14 @@
 #endif
 }
 
-#define PSTATE_N  (1 << 3)
-#define PSTATE_Z  (1 << 2)
-#define PSTATE_C  (1 << 1)
-#define PSTATE_V  (1 << 0)
+#define PSTATE_N_SHIFT 3
+#define PSTATE_N  (1 << PSTATE_N_SHIFT)
+#define PSTATE_Z_SHIFT 2
+#define PSTATE_Z  (1 << PSTATE_Z_SHIFT)
+#define PSTATE_C_SHIFT 1
+#define PSTATE_C  (1 << PSTATE_C_SHIFT)
+#define PSTATE_V_SHIFT 0
+#define PSTATE_V  (1 << PSTATE_V_SHIFT)
 
 /* you can call this signal handler from your SIGBUS and SIGSEGV
    signal handlers to inform the virtual CPU of exceptions. non zero
Index: qemu-1.6.0+dfsg/target-arm/translate-a64.c
===================================================================
--- qemu-1.6.0+dfsg.orig/target-arm/translate-a64.c	2013-11-05 22:23:33.767388540 +0000
+++ qemu-1.6.0+dfsg/target-arm/translate-a64.c	2013-11-05 22:23:33.763388551 +0000
@@ -816,7 +816,7 @@
 
     if (is_carry) {
         TCGv_i64 tcg_carry = tcg_temp_new_i64();
-        tcg_gen_shri_i64(tcg_carry, pstate, PSTATE_C);
+        tcg_gen_shri_i64(tcg_carry, pstate, PSTATE_C_SHIFT);
         tcg_gen_andi_i64(tcg_carry, tcg_carry, 1);
         tcg_gen_add_i64(tcg_result, tcg_result, tcg_carry);
 #if 0 /* XXX This is how the 32bit target does it, but the spec doesn't sound like it */
