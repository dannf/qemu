From 8e104b78a29352e0486beaefe012d975f205c6b7 Mon Sep 17 00:00:00 2001
From: Michael Matz <matz@suse.de>
Date: Wed, 10 Apr 2013 18:17:05 +0200
Subject: [PATCH 152/169] Fix getresuid, getresgid for !USE_UID16

This was hardcoding 16bit writes to the target.
---
 linux-user/syscall.c | 14 ++++++++++++++
 1 file changed, 14 insertions(+)

Index: qemu-1.6.0+dfsg/linux-user/syscall.c
===================================================================
--- qemu-1.6.0+dfsg.orig/linux-user/syscall.c	2013-11-05 22:23:47.043354176 +0000
+++ qemu-1.6.0+dfsg/linux-user/syscall.c	2013-11-05 22:23:47.043354176 +0000
@@ -8059,10 +8059,17 @@
             uid_t ruid, euid, suid;
             ret = get_errno(getresuid(&ruid, &euid, &suid));
             if (!is_error(ret)) {
+#ifdef USE_UID16
                 if (put_user_u16(high2lowuid(ruid), arg1)
                     || put_user_u16(high2lowuid(euid), arg2)
                     || put_user_u16(high2lowuid(suid), arg3))
                     goto efault;
+#else
+                if (put_user_u32(high2lowuid(ruid), arg1)
+                    || put_user_u32(high2lowuid(euid), arg2)
+                    || put_user_u32(high2lowuid(suid), arg3))
+                    goto efault;
+#endif
             }
         }
         break;
@@ -8080,10 +8087,17 @@
             gid_t rgid, egid, sgid;
             ret = get_errno(getresgid(&rgid, &egid, &sgid));
             if (!is_error(ret)) {
+#ifdef USE_UID16
                 if (put_user_u16(high2lowgid(rgid), arg1)
                     || put_user_u16(high2lowgid(egid), arg2)
                     || put_user_u16(high2lowgid(sgid), arg3))
                     goto efault;
+#else
+                if (put_user_u32(high2lowgid(rgid), arg1)
+                    || put_user_u32(high2lowgid(egid), arg2)
+                    || put_user_u32(high2lowgid(sgid), arg3))
+                    goto efault;
+#endif
             }
         }
         break;
