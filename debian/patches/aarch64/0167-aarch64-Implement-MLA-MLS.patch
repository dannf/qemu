From 6a4f603f537608677e951c43ac226fc5bd8871a4 Mon Sep 17 00:00:00 2001
From: Michael Matz <matz@suse.de>
Date: Fri, 11 Oct 2013 18:39:11 +0200
Subject: [PATCH 167/169] aarch64: Implement MLA/MLS

This implements the vector variant of MLA and MLS.
---
 target-arm/translate-a64.c | 9 +++++++++
 1 file changed, 9 insertions(+)

Index: qemu-1.6.0+dfsg/target-arm/translate-a64.c
===================================================================
--- qemu-1.6.0+dfsg.orig/target-arm/translate-a64.c	2013-11-05 22:23:50.095346277 +0000
+++ qemu-1.6.0+dfsg/target-arm/translate-a64.c	2013-11-05 22:23:50.091346287 +0000
@@ -2796,6 +2796,15 @@
                 tcg_gen_add_i64(tcg_res, tcg_op1, tcg_op2);
             }
             break;
+	case 0x12: /* MLA / MLS */
+	    tcg_gen_mul_i64(tcg_res, tcg_op1, tcg_op2);
+	    simd_ld(tcg_op1, freg_offs_d + i, size, !is_u);
+	    if (is_u) {
+		tcg_gen_sub_i64(tcg_res, tcg_op1, tcg_res);
+	    } else {
+		tcg_gen_add_i64(tcg_res, tcg_op1, tcg_res);
+	    }
+	    break;
 	case 0x13: /* MUL / PMUL */
 	    if (is_u) {
 		gen_helper_neon_mul_p8 (tcg_res, tcg_op1, tcg_op2);
